<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>


<body>
        <input id="txt" type="text" placeholder="請輸入內容">
        <button id="btn">add</button>
        <ul id="list"></ul>
        <h1 id="title"></h1>
        <div id="content"></div>
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyBTLe_wrvBO8b_RlQhLqqto6dvykDQDfGE",
          authDomain: "testbot-993f2.firebaseapp.com",
          databaseURL: "https://testbot-993f2.firebaseio.com",
          projectId: "testbot-993f2",
          storageBucket: "testbot-993f2.appspot.com",
          messagingSenderId: "837912342372"
        };
        firebase.initializeApp(config);

        // 排序
        // 由輕到重
    
    var people = {
        "bob": {
          "height" : 178,
          "old": 18,
          "weight": 70
        },
        "casper": {
          "height" : 180,
          "old" : 13,
          "weight" : 80
        },
        "mike":{
          "height" : 162,
          "old": 15,
          "weight": 55
        }
      };
      ///排序
      firebase.database().ref('people').set(people);
      var peopleRef=firebase.database().ref('people');
      peopleRef.orderByChild("old").once('value',function(snapshot){

          //console.log(snapshot.val());

         snapshot.forEach(function(item){ 
            console.log(item.val());
         })
      })
        //var database=firebase.database();
        //console.log(database);
        //ref() 尋找
        //set()
        //firebase.database().ref().set('hi');
        
        // var data= null;
        // data={
        //   student1:{
        //     name: 'tom',
        //     num: '1'
      
        //   },
        //   student2:{
        //     name: 'sim',
        //     num: '2'
      
        //   }
        // }
        // var data= null;
        // data={
        //   food:{
        //     coke:{
      
        //     },
        //     fries:{
      
        //     }
        //   }
      
        // }
        // firebase.database().ref().set(data);
        // firebase.database().ref('student1/name').set('rick');
        var myName= firebase.database().ref('student3');
        //once 讀取一次
        
        // myName.once('value',function(snapshot){
        //   console.log(snapshot.val());
           
        //    var dataSetObj = snapshot.val(), text= "";
        //     document.getElementById('title').textContent=dataSetObj;
        // });

        //on 持續監聽
        // myName.set('rick3');
        // myName.on('value',function(snapshot){
          
        //     var dataSetObj = snapshot.val();
        //     console.log(dataSetObj);
        //     document.getElementById('title').textContent=snapshot.val();
            
        // });

         //todos example
        var ref=firebase.database().ref();
        ref.on('value',function(snapshot){
            var path=document.getElementById('content');
            path.textContent=JSON.stringify(snapshot.val(),null,3);


        });
        var txt=document.getElementById("txt");
        var send=document.getElementById("btn");
        var list=document.getElementById("list");
        var todos=firebase.database().ref('todos');
        
        //once 讀取一次
        todos.once('value',function(snapshot){
                     var str='';
                    var data=snapshot.val();
                    for (var item in data) {
                        
                        console.log(item);
                        str+='<li data-key="'+ item +'">'+data[item].content+'</li>';
                    }
                    console.log(str);
                    list.innerHTML=str;
    
        })



        //案送出按鈕
        send.addEventListener("click",function(e){
                console.log(txt.value);
                todos.push({content:txt.value});
                //顯示內容，on 持續更新
                todos.on('value',function(snapshot){

                    
                    var str='';
                    var data=snapshot.val();
                    for (var item in data) {
                        
                        console.log(item);
                        str+='<li data-key="'+ item +'">'+data[item].content+'</li>';
                    }
                    console.log(str);
                    list.innerHTML=str;
                })
            
        })
        //刪除
        list.addEventListener('click',function(e){
            if(e.target.nodeName="LI"){

                 var key =e.target.dataset.key;
                 todos.child(key).remove();
            }
        })

      </script>

</body>


</html>